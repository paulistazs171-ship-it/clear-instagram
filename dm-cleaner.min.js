!function(){"use strict";const e=1e4,o=50,t=3e4,n=100,r=!0,a='div[aria-label^="Messages in conversation with"], div[aria-label^="Mensagens na conversa com"]',i='div[role="row"]:has(div[role="gridcell"])',s='div[role="button"][aria-label="Double tap to like"], div[role="button"][aria-label="Toque duas vezes para curtir"]',l='svg[aria-label^="See more options for message from"], svg[aria-label^="Ver mais opções da mensagem de"]',c='a[href*="/"][aria-label^="Open the profile page of"], a[href*="/"][aria-label^="Abrir a página do perfil de"]',d={ativo:!1,controladorAbortar:null,desbloqueadorInteracao:null,estadoRolagem:null,funcoesLimpeza:[],totalRemovidas:0,urlAnterior:window.location.href},u={aguardar:e=>new Promise(o=>setTimeout(o,e)),ultimo:e=>e[e.length-1],pausaAcao:()=>u.aguardar(o),log:(...e)=>{r&&console.log("[DM Cleaner]",...e)},comAbortar:(e,o,t="operação")=>new Promise((n,r)=>{if(o?.aborted)return r(new Error(`Abortado: ${t}`));const a=()=>r(new Error(`Abortado: ${t}`));o?.addEventListener("abort",a,{once:!0}),e.then(e=>{o?.removeEventListener("abort",a),n(e)},e=>{o?.removeEventListener("abort",a),r(e)})}),comTempoLimite:(e,o,t,n)=>Promise.race([u.comAbortar(e,t,n),new Promise((e,t)=>setTimeout(()=>t(new Error(`Tempo esgotado aguardando: ${n}`)),o))])},m={aguardarSeletor(e,o={}){const{raiz:t=document,sinal:n,rotulo:r=e}=o,a=t.querySelector(e);return a?Promise.resolve(a):new Promise((o,a)=>{if(n?.aborted)return a(new Error(`Abortado: ${r}`));const i=new MutationObserver(()=>{const n=t.querySelector(e);n&&(i.disconnect(),o(n))});i.observe(t,{childList:!0,subtree:!0});const s=()=>{i.disconnect(),a(new Error(`Abortado: ${r}`))};n?.addEventListener("abort",s,{once:!0}),d.funcoesLimpeza.push(()=>{try{i.disconnect()}catch{}n?.removeEventListener?.("abort",s)})})},aguardarCorrespondencia(e={}){const{raiz:o=document,corresponde:t,sinal:n,rotulo:r="correspondência"}=e,a=e=>{if(e instanceof Element&&t(e))return e;if(!(e instanceof Element&&e.querySelectorAll))return null;for(const o of e.querySelectorAll("*"))if(t(o))return o;return null},i=a(o);return i?Promise.resolve(i):new Promise((e,t)=>{if(n?.aborted)return t(new Error(`Abortado: ${r}`));const i=new MutationObserver(o=>{for(const t of o)for(const o of t.addedNodes){const t=a(o);if(t)return i.disconnect(),void e(t)}});i.observe(o,{childList:!0,subtree:!0});const s=()=>{i.disconnect(),t(new Error(`Abortado: ${r}`))};n?.addEventListener("abort",s,{once:!0}),d.funcoesLimpeza.push(()=>{try{i.disconnect()}catch{}n?.removeEventListener?.("abort",s)})})},aguardarRemocao(e,o={}){const{raiz:t=document,sinal:n,rotulo:r="remoção"}=o;return e&&e.isConnected?new Promise((o,a)=>{if(n?.aborted)return a(new Error(`Abortado: ${r}`));const i=new MutationObserver(()=>{e.isConnected||(i.disconnect(),o(!0))});i.observe(t,{childList:!0,subtree:!0});const s=()=>{i.disconnect(),a(new Error(`Abortado: ${r}`))};n?.addEventListener("abort",s,{once:!0}),d.funcoesLimpeza.push(()=>{try{i.disconnect()}catch{}n?.removeEventListener?.("abort",s)})}):Promise.resolve(!0)}},p={obterRaizConversa:()=>document.querySelector(a)||document.body,obterLinhasMensagens:()=>Array.from(document.querySelectorAll(i)).filter(e=>null!==e.offsetParent),obterRolagemAncestral(e,o=10){let t=e;for(let e=0;e<o&&t&&(t=t.parentElement,t);e++){const e=getComputedStyle(t).overflowY;if(("auto"===e||"scroll"===e)&&t.scrollHeight>t.clientHeight+1)return t}const n=p.obterRaizConversa(),r=n?getComputedStyle(n):null;return n&&r&&("auto"===r.overflowY||"scroll"===r.overflowY)&&n.scrollHeight>n.clientHeight+1?n:document.scrollingElement||document.documentElement},verificarEstadoPerfilVisivel(){const e=p.obterRaizConversa(),o=Array.from(e.querySelectorAll("a")).find(e=>{const o=(e.textContent||"").trim();return"View profile"===o||"Ver perfil"===o});if(!o)return{encontrado:!1,visivel:!1};const t=o.getBoundingClientRect(),n=window.innerHeight||document.documentElement.clientHeight,r=window.innerWidth||document.documentElement.clientWidth;return{encontrado:!0,visivel:t.bottom>0&&t.top<n&&t.right>0&&t.left<r,elemento:o}},rolarLinhaParaVisao(e,o,t="top",n=12){const r=e.getBoundingClientRect(),a=o.getBoundingClientRect();let i;i="top"===t?a.top-r.top-n:a.bottom-r.bottom+n;const s=e.scrollTop;return e.scrollTop+=i,e.scrollTop!==s},clicarElemento(e){u.log("Tentando clicar em:",e);try{return e.click(),u.log("✓ Click direto executado"),!0}catch(e){u.log("✗ Click direto falhou:",e.message)}try{return["mousedown","mouseup","click"].forEach(o=>{e.dispatchEvent(new MouseEvent(o,{view:window,bubbles:!0,cancelable:!0,buttons:1}))}),u.log("✓ MouseEvents disparados"),!0}catch(e){u.log("✗ MouseEvents falharam:",e.message)}try{return["pointerdown","pointerup"].forEach(o=>{e.dispatchEvent(new PointerEvent(o,{view:window,bubbles:!0,cancelable:!0,isPrimary:!0}))}),e.click(),u.log("✓ PointerEvents + click executados"),!0}catch(e){u.log("✗ PointerEvents falharam:",e.message)}return!1}},g={congelar(){const e=document.body,o=document.documentElement,t=window.scrollY||o.scrollTop||e.scrollTop||0,n=window.scrollX||o.scrollLeft||e.scrollLeft||0;d.estadoRolagem={x:n,y:t,estilos:{position:e.style.position,width:e.style.width,overflow:e.style.overflow,top:e.style.top,left:e.style.left,right:e.style.right}},e.style.position="fixed",e.style.width="100%",e.style.overflow="hidden",e.style.top=`-${t}px`,e.style.left=`-${n}px`,e.style.right="0"},descongelar(){const e=document.body;if(!d.estadoRolagem)return;const{x:o,y:t,estilos:n}=d.estadoRolagem;e.style.position=n.position,e.style.width=n.width,e.style.overflow=n.overflow,e.style.top=n.top,e.style.left=n.left,e.style.right=n.right,d.estadoRolagem=null,window.scrollTo(o,t)}},v={ativar(){const e=["click","dblclick","auxclick","contextmenu","mousedown","mouseup","pointerdown","pointerup","pointermove","touchstart","touchmove","touchend","wheel","dragstart","selectstart","keydown","keyup"],o=e=>{if(!e.isTrusted)return;const o=e.target;return(o&&"function"==typeof o.closest?o.closest("#painelControle"):null)||"mouseover"===e.type||"mouseenter"===e.type||"mousemove"===e.type?void 0:(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!1)},t=[];for(const n of e){const e={capture:!0,passive:!1};window.addEventListener(n,o,e),document.addEventListener(n,o,e),t.push({evt:n,manipulador:o,opts:e})}return()=>{for(const{evt:e,manipulador:o,opts:n}of t)window.removeEventListener(e,o,n),document.removeEventListener(e,o,n)}}},b={atualizarStatus(e=null){const o=document.getElementById("statusTexto");o&&(o.textContent=e||`${d.totalRemovidas} mensagens removidas`)},criarOverlay(){const e=document.createElement("div");e.id="overlayBloqueio",e.style.cssText='\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100vw;\n  height: 100vh;\n  background: rgba(30, 30, 30, 0.6);  /* Fundo cinza escuro mais transparente */\n  backdrop-filter: blur(0.5px);         /* Blur bem leve para manter um pouco de "frosted glass" */\n  z-index: 2147483646;\n  pointer-events: auto;\n  cursor: not-allowed;\n';const o=e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()};["pointerdown","pointerup","pointermove","mousedown","mouseup","click","contextmenu","touchstart","touchmove","touchend","wheel","dragstart"].forEach(t=>e.addEventListener(t,o,!0)),document.body.appendChild(e);const t=document.createElement("div");t.id="copyrightBrunno",t.style.cssText="\n        position: fixed;\n        bottom: 20px;\n        left: 20px;\n        z-index: 2147483647;\n        color: #a3a3a3;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n        font-size: 12px;\n        font-weight: 400;\n        text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);\n        pointer-events: none;\n        user-select: none;\n      ",t.innerHTML="© 2025 Brunno Bots. Todos os direitos reservados.",document.body.appendChild(t)},criarPainelControle(){const e=document.createElement("div");e.id="painelControle",e.style.cssText="\n        position: fixed;\n        top: 20px;\n        right: 20px;\n        z-index: 2147483647;\n        background: #1a1a1a;\n        padding: 20px;\n        border-radius: 8px;\n        border: 1px solid #2a2a2a;\n        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.5);\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n        min-width: 260px;\n        animation: slideIn 0.2s ease-out;\n      ",e.innerHTML='\n        <style>\n          @keyframes slideIn {\n            from {\n              transform: translateX(320px);\n              opacity: 0;\n            }\n            to {\n              transform: translateX(0);\n              opacity: 1;\n            }\n          }\n          @keyframes dots {\n            0%, 20% { content: \'.\'; }\n            40% { content: \'..\'; }\n            60%, 100% { content: \'...\'; }\n          }\n          .loading-dots::after {\n            content: \'...\';\n            animation: dots 1.5s infinite;\n          }\n        </style>\n        <div style="display: flex; flex-direction: column; gap: 16px;">\n          <div style="display: flex; align-items: center; gap: 8px; padding-bottom: 12px; border-bottom: 1px solid #2a2a2a;">\n            <div style="\n              width: 6px;\n              height: 6px;\n              background: #10b981;\n              border-radius: 50%;\n            "></div>\n            <span style="\n              color: #e5e5e5;\n              font-size: 12px;\n              font-weight: 500;\n              text-transform: uppercase;\n              letter-spacing: 0.5px;\n            ">Em Progresso</span>\n          </div>\n          <div id="statusTexto" style="\n            color: #a3a3a3;\n            font-size: 14px;\n            font-weight: 400;\n          " class="loading-dots">Iniciando</div>\n          <button id="botaoCancelar" style="\n            background: #262626;\n            color: #e5e5e5;\n            border: 1px solid #3a3a3a;\n            border-radius: 6px;\n            padding: 10px 16px;\n            font-weight: 500;\n            font-size: 13px;\n            cursor: pointer;\n            transition: all 0.15s;\n          " onmouseover="this.style.background=\'#ef4444\'; this.style.borderColor=\'#ef4444\';" onmouseout="this.style.background=\'#262626\'; this.style.borderColor=\'#3a3a3a\';">\n            Cancelar\n          </button>\n        </div>\n      ',document.body.appendChild(e),document.getElementById("botaoCancelar").onclick=f.parar},injetarBotaoInicial(e,o){if(document.getElementById("botaoLimparMensagens"))return;const t=document.createElement("button");t.id="botaoLimparMensagens",t.innerHTML="Limpar",t.style.cssText="\n        background: #1a1a1a;\n        color: #e5e5e5;\n        border: 1px solid #2a2a2a;\n        border-radius: 6px;\n        padding: 7px 14px;\n        font-weight: 500;\n        font-size: 13px;\n        cursor: pointer;\n        margin-left: auto;\n        margin-right: 12px;\n        transition: all 0.15s ease;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n      ",t.onmouseover=()=>{t.style.background="#262626",t.style.borderColor="#3a3a3a"},t.onmouseout=()=>{t.style.background="#1a1a1a",t.style.borderColor="#2a2a2a"},t.onclick=f.iniciar,e.insertBefore(t,o)},removerBotaoInicial(){document.getElementById("botaoLimparMensagens")?.remove()},removerInterface(){document.getElementById("overlayBloqueio")?.remove(),document.getElementById("painelControle")?.remove(),document.getElementById("copyrightBrunno")?.remove()}},f={async iniciar(){if(d.ativo)return;d.ativo=!0,d.totalRemovidas=0,d.controladorAbortar=new AbortController,u.log("Iniciando processo de remoção...");const e=document.getElementById("botaoLimparMensagens");e&&(e.style.display="none"),b.criarOverlay(),b.criarPainelControle(),d.desbloqueadorInteracao=v.ativar(),g.congelar();try{await f.executarLimpeza(d.controladorAbortar.signal),d.ativo&&f.parar()}catch(e){console.error("[Limpeza DM] Erro durante o processo:",e),f.parar()}},parar(){if(!d.ativo&&!document.getElementById("overlayBloqueio"))return;u.log("Parando processo..."),d.ativo=!1;try{d.controladorAbortar?.abort()}catch{}d.controladorAbortar=null;try{d.desbloqueadorInteracao?.()}catch{}d.desbloqueadorInteracao=null;try{d.funcoesLimpeza.forEach(e=>e())}catch{}d.funcoesLimpeza=[],g.descongelar(),b.removerInterface();const e=document.getElementById("botaoLimparMensagens");e&&(e.style.display="inline-block"),u.log(`Processo finalizado. Total: ${d.totalRemovidas} mensagens`)},async executarLimpeza(o){const r=await u.comTempoLimite(m.aguardarSeletor(a,{raiz:document,sinal:o,rotulo:"container da conversa"}),e,o,"container da conversa"),g=p.obterLinhasMensagens()[0];if(g){const e=p.obterRolagemAncestral(g);e.scrollTop=e.scrollHeight}await u.aguardar(800);let f=null;const y=(e=t)=>new Promise((t,n)=>{if(o?.aborted)return n(new Error("Abortado: aguardar novas mensagens"));if(f){const e=()=>{f?setTimeout(e,50):t()};return void e()}let r=!1;const a=setTimeout(()=>{r=!0,f=null,n(new Error("Tempo esgotado aguardando novas mensagens"))},e),i=()=>{clearTimeout(a),f=null,n(new Error("Abortado: aguardar novas mensagens"))};o?.addEventListener("abort",i,{once:!0}),f=()=>{r||(clearTimeout(a),o?.removeEventListener("abort",i),f=null,t())}}),h=p.obterRaizConversa(),w=new MutationObserver(e=>{for(const o of e)if(o.addedNodes&&o.addedNodes.length)return void(f&&f())});w.observe(h,{childList:!0,subtree:!0}),d.funcoesLimpeza.push(()=>{try{w.disconnect()}catch{}});const E=e=>[...e.querySelectorAll(i)].filter(e=>null!==e.offsetParent).filter(e=>{if(!e.querySelector(s))return!1;const o=e.innerText;if(o.includes("Unsupported message")||o.includes("Mensagem não compatível"))return!1;return!e.querySelector(c)}),x=async()=>{const t=E(r),n=u.ultimo(t);if(!n)throw new Error("Nenhuma mensagem elegível encontrada.");await(async t=>{if(o?.aborted)throw new Error("Abortado: remover mensagem");u.log("=== Iniciando remoção de mensagem ===");const n=p.obterRolagemAncestral(t);try{p.rolarLinhaParaVisao(n,t,"top",16)}catch{}await u.pausaAcao(),d.desbloqueadorInteracao&&(d.desbloqueadorInteracao(),d.desbloqueadorInteracao=null);const a=t.querySelector(s)||t;a.dispatchEvent(new MouseEvent("mouseenter",{bubbles:!0,cancelable:!0})),a.dispatchEvent(new MouseEvent("mouseover",{bubbles:!0,cancelable:!0})),a.dispatchEvent(new MouseEvent("mousemove",{bubbles:!0,cancelable:!0})),await u.aguardar(600);let i=t.querySelector(l);i||(i=Array.from(t.querySelectorAll("svg[aria-label]")).find(e=>{const o=e.getAttribute("aria-label");return o&&(o.includes("options")||o.includes("opções")||o.includes("More")||o.includes("Mais"))}));if(!i)throw new Error("Ícone de mais opções não encontrado após hover");u.log("Ícone de mais opções encontrado"),d.desbloqueadorInteracao=v.ativar(),await u.pausaAcao();const c=i.closest('div[role="button"]')||i.parentElement;u.log("Clicando no botão de mais opções..."),p.clicarElemento(c),await u.aguardar(400),u.log("Procurando item menu Unsend/Anular envio...");const g=await u.comTempoLimite(m.aguardarCorrespondencia({raiz:document.body,sinal:o,rotulo:"item do menu Cancelar/Anular envio",corresponde:e=>{if(!e.textContent)return!1;const o=e.textContent.trim(),t=["Unsend","Cancelar envio","Anular envio"].includes(o),n="SPAN"===e.tagName||"DIV"===e.tagName,r=!!e.closest('div[role="dialog"]');return!!(t&&n&&r)&&(u.log("Item menu encontrado:",{tag:e.tagName,texto:o,dentroDialog:r}),!0)}}),e,o,"item do menu Cancelar/Anular envio");u.log("Item menu Unsend encontrado, clicando...");const b=g.closest('div[role="button"]')||g.closest("button")||g.parentElement;p.clicarElemento(b),await u.aguardar(400),u.log("Procurando botão confirmar Unsend/Anular envio...");const f=await u.comTempoLimite(m.aguardarCorrespondencia({raiz:document.body,sinal:o,rotulo:"botão confirmar Cancelar/Anular envio",corresponde:e=>{if("BUTTON"!==e.tagName)return!1;const o=e.textContent?.trim();return!!["Unsend","Cancelar envio","Anular envio"].includes(o)&&(u.log("Botão confirmar encontrado:",{texto:o}),!0)}}),e,o,"botão confirmar Cancelar/Anular envio");u.log("Clicando no botão confirmar..."),p.clicarElemento(f),await u.aguardar(400),u.log("Aguardando remoção da mensagem do DOM..."),await u.comTempoLimite(m.aguardarRemocao(t,{raiz:r,sinal:o,rotulo:"remoção da linha de mensagem"}),e,o,"remoção da mensagem"),u.log("✓ Mensagem removida com sucesso!"),await u.pausaAcao()})(n)},A=async()=>{let e=0;for(;!o?.aborted;)try{await x(),e++,d.totalRemovidas++,b.atualizarStatus()}catch(e){if(/Nenhuma mensagem elegível/.test(String(e?.message)))break;throw e}return e},L=async()=>{const e=p.verificarEstadoPerfilVisivel();if(e.encontrado&&e.visivel)return!1;let o=p.obterLinhasMensagens();if(!o.length){try{await y(t)}catch{}return!0}const r=p.obterRolagemAncestral(o[0]),a=r.getBoundingClientRect();let i=o.findIndex(e=>{const o=e.getBoundingClientRect();return o.bottom>a.top+1&&o.top<a.bottom-1});-1===i&&(i=o.length-1);const s=o[Math.max(0,i-1)];let l=p.rolarLinhaParaVisao(r,s,"top",16);if(!l){const e=r.scrollTop;r.scrollBy(0,-Math.max(80,Math.floor(.7*r.clientHeight))),l=r.scrollTop!==e}if(l||!(r.scrollTop<=1)||e.encontrado&&e.visivel)await u.aguardar(n);else try{await y(t)}catch{}return!0};for(b.atualizarStatus("Iniciando limpeza...");!o?.aborted;){const e=await A();e>0&&u.log(`${e} mensagem(ns) removida(s) nesta passagem (total: ${d.totalRemovidas})`);const o=p.verificarEstadoPerfilVisivel(),t=E(r);if(o.encontrado&&o.visivel&&0===t.length){u.log("Chegou ao topo e não há mais mensagens. Concluído!"),b.atualizarStatus(`✅ Concluído! ${d.totalRemovidas} mensagens removidas`),await u.aguardar(2e3);break}if(!await L())break}if(o?.aborted)throw new Error("Abortado: execução")}},y={verificarMudancaUrl(){const e=window.location.href;e!==d.urlAnterior&&(d.urlAnterior=e,d.ativo&&(console.warn("[Limpeza DM] URL alterada durante o processo. Parando..."),f.parar()));if(window.location.pathname.startsWith("/direct/t/")){const e=document.querySelector('svg[aria-label="Conversation information"]')?.closest('div[role="button"]')||document.querySelector('svg[aria-label="Informações da conversa"]')?.closest('div[role="button"]');if(e?.parentElement?.parentElement){const o=e.parentElement.parentElement;o.querySelector('a[aria-label^="Open the profile page of"], a[aria-label^="Abrir a página do perfil de"]')&&b.injetarBotaoInicial(o,e.parentElement)}}else b.removerBotaoInicial()}};console.log("✨ Instagram - Limpar Mensagens DM carregado com sucesso!");new MutationObserver(y.verificarMudancaUrl).observe(document.body,{childList:!0,subtree:!0}),y.verificarMudancaUrl()}();